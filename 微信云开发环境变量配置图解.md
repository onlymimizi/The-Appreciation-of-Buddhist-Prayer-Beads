# 微信云开发环境变量配置图解

## 🎯 完整操作流程

### 第一步：部署云函数
```
微信开发者工具
├── 项目文件夹
│   └── miniprogram/
│       └── cloudfunctions/
│           └── appraiseBads/  ← 右键点击这个文件夹
│               ├── index.js
│               ├── package.json
│               └── config.json
```

**操作：**
1. 右键点击 `appraiseBads` 文件夹
2. 选择 **"上传并部署：云端安装依赖"**
3. 等待上传完成

### 第二步：进入云开发控制台
```
微信开发者工具界面
├── 菜单栏
│   ├── 文件
│   ├── 编辑  
│   ├── 项目
│   ├── 工具
│   └── 云开发  ← 点击这里
```

### 第三步：找到云函数配置
```
云开发控制台界面
├── 左侧菜单
│   ├── 概览
│   ├── 用户管理
│   ├── 数据库
│   ├── 存储
│   ├── 云函数  ← 点击这里
│   └── 统计分析
│
└── 右侧内容区
    └── 云函数列表
        └── appraiseBads  ← 点击这个函数名
```

### 第四步：进入函数配置
```
appraiseBads 函数详情页
├── 选项卡
│   ├── 函数代码
│   ├── 版本与配置  ← 点击这里
│   └── 监控信息
│
└── 版本与配置页面
    ├── 基础配置
    ├── 配置  ← 点击这个子选项卡
    └── 版本管理
```

### 第五步：配置环境变量
```
配置页面
├── 基本信息
├── 运行环境
├── 环境变量  ← 找到这个部分
│   └── [编辑] 按钮  ← 点击编辑
└── 网络配置
```

### 第六步：添加环境变量
```
环境变量编辑界面
├── 现有环境变量列表
├── [添加] 按钮  ← 点击添加新变量
└── 变量输入框
    ├── 变量名: [输入框]
    └── 变量值: [输入框]
```

**需要添加的三个变量：**

**第1个变量：**
```
变量名: OPENROUTER_API_KEY
变量值: sk-or-v1-你的实际API密钥
```

**第2个变量：**
```
变量名: OPENROUTER_BASE_URL
变量值: https://openrouter.ai/api/v1/chat/completions
```

**第3个变量：**
```
变量名: MODEL_NAME
变量值: qwen/qwen-vl-plus
```

### 第七步：保存配置
1. 添加完所有三个变量后
2. 点击 **"保存"** 按钮
3. 等待配置生效（2-3分钟）

## ⚠️ 常见问题

### Q1: 找不到"云开发"按钮？
**A:** 确保项目已开启云开发功能：
1. 项目设置 → 云开发 → 开启云开发
2. 选择环境或创建新环境

### Q2: 找不到云函数列表？
**A:** 确保云函数已成功部署：
1. 检查上传是否成功
2. 刷新云开发控制台
3. 确认网络连接正常

### Q3: 环境变量不生效？
**A:** 检查以下几点：
1. 变量名拼写是否正确
2. 是否点击了"保存"按钮
3. 等待2-3分钟让配置生效
4. 重新部署云函数

### Q4: API密钥格式错误？
**A:** OpenRouter API密钥格式：
- 正确格式：`sk-or-v1-xxxxxxxxxxxxxxxx`
- 长度通常为40-50个字符
- 以 `sk-or-v1-` 开头

## 🔍 验证配置是否成功

### 方法1：查看云函数日志
1. 云函数详情页 → "监控信息"
2. 查看"调用日志"
3. 确认没有环境变量相关错误

### 方法2：测试调用
在微信开发者工具控制台运行：
```javascript
wx.cloud.callFunction({
  name: 'appraiseBads',
  data: { action: 'materials' }
}).then(res => {
  console.log('配置成功！', res.result)
}).catch(err => {
  console.error('配置失败：', err)
})
```

如果返回材质列表数据，说明配置成功！🎉